<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>赛博文豪</title>
  <style>
    body { font-family: sans-serif; padding: 16px; }
    textarea, input { box-sizing: border-box; }
    .step { padding:6px 14px;border-radius:20px;cursor:pointer; }
    .btn { padding:4px 8px; cursor:pointer; }
    .mini { width:28px; }
    .card { border:1px solid #ddd; padding:12px; margin-bottom:16px; }
  </style>
</head>
<body>

<h1>赛博文豪</h1>

<script>
/* ===== 基础状态 ===== */
let stages = ["idea", "setting", "outline", "volume", "chapter"];
let stage = localStorage.getItem("stage") || "idea";

let data = JSON.parse(localStorage.getItem("data")) || {
  idea: "",
  setting: "",
  outline: "",
  volumes: []
};

function save(){
  localStorage.setItem("stage", stage);
  localStorage.setItem("data", JSON.stringify(data));
}

/* ===== 标题 ===== */
const titleMap = {
  idea: "脑洞",
  setting: "世界观",
  outline: "全书大纲",
  volume: "卷纲",
  chapter: "章节细纲"
};

/* ===== 绘制步骤 ===== */
function drawSteps(){
  return `
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
      ${stages.map(s=>`
        <div class="step"
          onclick="jump('${s}')"
          style="background:${s===stage?'#111':'#eee'};
          color:${s===stage?'#fff':'#333'};">
          ${titleMap[s]}
        </div>
      `).join("")}
    </div>
  `;
}

/* ===== 主绘制 ===== */
function drawPage(){
  const body = document.body;

  /* ===== 普通阶段 ===== */
  if(stage !== "volume"){
    body.innerHTML = `
      <h1>赛博文豪</h1>
      ${drawSteps()}
      <p><b>当前阶段：${titleMap[stage]}</b></p>
      <textarea id="input" style="width:100%;height:260px;">${data[stage]||""}</textarea>
    `;
    return;
  }

  /* ===== 卷纲阶段 ===== */
  body.innerHTML = `
    <h1>赛博文豪</h1>
    ${drawSteps()}
    <p><b>当前阶段：卷纲</b></p>

    <div style="margin-bottom:12px;">
      卷数：
      <b>${data.volumes.length}</b>
      <button class="btn mini" onclick="addVolume()">＋</button>
      <button class="btn mini" onclick="removeVolume()">－</button>
    </div>

    ${data.volumes.map((v,i)=>`
      <div class="card">
        <b>第 ${i+1} 卷</b><br><br>

        卷名：<br>
        <input style="width:100%;" value="${v.title||""}"
          oninput="updateVolume(${i},'title',this.value)"><br><br>

        卷简介：<br>
        <textarea style="width:100%;height:80px;"
          oninput="updateVolume(${i},'desc',this.value)">${v.desc||""}</textarea><br><br>

        本卷主要角色：<br>
        <textarea style="width:100%;height:60px;"
          oninput="updateVolume(${i},'roles',this.value)">${v.roles||""}</textarea><br><br>

        本卷章节数：
        <input type="number" min="1" style="width:80px;"
          value="${v.chapterCount||1}"
          oninput="updateVolume(${i},'chapterCount',this.value)">

        <br><br>
        <button class="btn">根据全书大纲生成本卷章节概述（占位）</button>
      </div>
    `).join("")}
  `;
}

/* ===== 数据操作 ===== */
function addVolume(){
  data.volumes.push({
    title:"",
    desc:"",
    roles:"",
    chapterCount:1
  });
  save(); drawPage();
}

function removeVolume(){
  if(data.volumes.length>0){
    data.volumes.pop();
    save(); drawPage();
  }
}

function updateVolume(i,f,v){
  data.volumes[i][f]=v;
  save();
}

/* ===== 跳转 ===== */
function jump(t){
  const input=document.getElementById("input");
  if(input) data[stage]=input.value;
  stage=t;
  save();
  drawPage();
}

drawPage();
</script>

</body>
</html>