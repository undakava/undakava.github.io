<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>赛博文豪</title>
</head>
<body>

<h1>赛博文豪</h1>

<div id="app"></div>

<script>
let currentVolume = 0;

let data = JSON.parse(localStorage.getItem("data")) || {
  volumes: [
    { chapters: [] }
  ]
};

function save() {
  localStorage.setItem("data", JSON.stringify(data));
}

function btn(text, fn) {
  return `<button onclick="${fn}"
    style="
      width:22px;height:22px;
      margin-left:4px;
      border:1px solid #ccc;
      background:#f7f7f7;
      color:#333;
      border-radius:4px;
      cursor:pointer;
      padding:0;
    ">${text}</button>`;
}

function render() {
  const app = document.getElementById("app");
  const v = data.volumes[currentVolume];

  app.innerHTML = `
    <h2>章节细纲</h2>

    <div>
      卷数：${data.volumes.length}
      ${btn("＋", "addVolume()")}
      ${btn("－", "removeVolume()")}
    </div>

    <div style="margin-top:8px;">
      当前卷：
      <select onchange="switchVolume(this.value)">
        ${data.volumes.map((_, i) =>
          `<option value="${i}" ${i===currentVolume?"selected":""}>第 ${i+1} 卷</option>`
        ).join("")}
      </select>
    </div>

    <div style="margin-top:8px;">
      章节数：
      <input type="number" min="1" value="${v.chapters.length || 1}"
        style="width:60px"
        onchange="setChapterCount(this.value)">
      ${btn("＋", "changeChapter(1)")}
      ${btn("－", "changeChapter(-1)")}
    </div>

    <hr>

    ${v.chapters.map((c, i) => `
      <div style="margin-bottom:20px;">
        <b>第 ${i+1} 章</b><br><br>

        章节名：<br>
        <input style="width:100%;" value="${c.title||""}"
          oninput="updateChapter(${i}, 'title', this.value)"><br><br>

        章节概述：<br>
        <textarea style="width:100%;height:60px;"
          oninput="updateChapter(${i}, 'summary', this.value)">${c.summary||""}</textarea><br><br>

        章节细纲：<br>
        <textarea style="width:100%;height:100px;"
          oninput="updateChapter(${i}, 'detail', this.value)">${c.detail||""}</textarea>
      </div>
    `).join("")}
  `;
}

function addVolume() {
  data.volumes.push({ chapters: [] });
  save(); render();
}

function removeVolume() {
  if (data.volumes.length > 1) {
    data.volumes.pop();
    currentVolume = Math.max(0, currentVolume - 1);
  }
  save(); render();
}

function switchVolume(i) {
  currentVolume = Number(i);
  save(); render();
}

function setChapterCount(n) {
  const v = data.volumes[currentVolume];
  n = Math.max(1, Number(n));
  while (v.chapters.length < n)
    v.chapters.push({ title:"", summary:"", detail:"" });
  while (v.chapters.length > n)
    v.chapters.pop();
  save(); render();
}

function changeChapter(d) {
  const v = data.volumes[currentVolume];
  setChapterCount(v.chapters.length + d);
}

function updateChapter(i, field, val) {
  data.volumes[currentVolume].chapters[i][field] = val;
  save();
}

render();
</script>

</body>
</html>