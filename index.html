<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>赛博文豪</title>
<style>
body {
  font-family: "PingFang SC","Microsoft YaHei",sans-serif;
  background:#f5f6f8;
  padding:20px;
}
h1 { text-align:center; }
.stage {
  font-size:18px;
  font-weight:bold;
  margin-bottom:12px;
}
.box {
  background:#fff;
  padding:16px;
  border-radius:8px;
  margin-bottom:16px;
}
textarea, button {
  width:100%;
  font-size:14px;
  padding:10px;
  margin-top:10px;
}
button {
  background:#111;
  color:#fff;
  border:none;
  border-radius:6px;
}
#result {
  white-space:pre-wrap;
  background:#eee;
  padding:12px;
  border-radius:6px;
}
</style>
</head>

<body>

<h1>赛博文豪</h1>

<div class="box">
  <div id="stageTitle" class="stage"></div>
  <div id="mainArea"></div>
  <button id="actionBtn"></button>
</div>

<div id="result" style="display:none;"></div>

<script>
let stage = "chapter";
let currentVolume = 0;

let data = JSON.parse(localStorage.getItem("data")) || {
  volumes: [
    {
      chapters: []
    }
  ]
};

function save() {
  localStorage.setItem("data", JSON.stringify(data));
}

function smallBtn(text, onclick) {
  return `<button onclick="${onclick}"
    style="
      width:22px;height:22px;
      margin-left:4px;
      border:1px solid #ccc;
      background:#f9f9f9;
      color:#333;
      border-radius:4px;
      cursor:pointer;
      padding:0;
      line-height:1;
    ">${text}</button>`;
}

function draw() {
  const v = data.volumes[currentVolume];

  document.body.innerHTML = `
    <h2>章节细纲</h2>

    <div style="margin-bottom:10px;">
      卷数： ${data.volumes.length}
      ${smallBtn("＋", "addVolume()")}
      ${smallBtn("－", "removeVolume()")}
    </div>

    <div style="margin-bottom:10px;">
      当前卷：
      <select onchange="switchVolume(this.value)">
        ${data.volumes.map((_, i) =>
          `<option value="${i}" ${i===currentVolume?"selected":""}>第 ${i+1} 卷</option>`
        ).join("")}
      </select>
    </div>

    <div style="margin-bottom:14px;">
      章节数：
      <input type="number" min="1" value="${v.chapters.length || 1}"
        style="width:60px"
        onchange="setChapterCount(this.value)">
      ${smallBtn("＋", "changeChapter(1)")}
      ${smallBtn("－", "changeChapter(-1)")}
    </div>

    <hr>

    ${v.chapters.map((c, i) => `
      <div style="margin-bottom:20px;">
        <b>第 ${i+1} 章</b><br><br>

        章节名：<br>
        <input style="width:100%;" value="${c.title||""}"
          oninput="updateChapter(${i}, 'title', this.value)"><br><br>

        章节概述：<br>
        <textarea style="width:100%;height:60px;"
          oninput="updateChapter(${i}, 'summary', this.value)">${c.summary||""}</textarea><br><br>

        章节细纲：<br>
        <textarea style="width:100%;height:100px;"
          oninput="updateChapter(${i}, 'detail', this.value)">${c.detail||""}</textarea>
      </div>
    `).join("")}
  `;
}

function addVolume() {
  data.volumes.push({ chapters: [] });
  save(); draw();
}

function removeVolume() {
  if (data.volumes.length > 1) {
    data.volumes.pop();
    currentVolume = Math.max(0, currentVolume - 1);
  }
  save(); draw();
}

function switchVolume(i) {
  currentVolume = Number(i);
  save(); draw();
}

function setChapterCount(n) {
  const v = data.volumes[currentVolume];
  n = Math.max(1, Number(n));
  while (v.chapters.length < n)
    v.chapters.push({ title:"", summary:"", detail:"" });
  while (v.chapters.length > n)
    v.chapters.pop();
  save(); draw();
}

function changeChapter(d) {
  const v = data.volumes[currentVolume];
  setChapterCount(v.chapters.length + d);
}

function updateChapter(i, field, val) {
  data.volumes[currentVolume].chapters[i][field] = val;
  save();
}

draw();
</script>

</body>
</html>